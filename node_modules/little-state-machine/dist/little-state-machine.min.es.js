import{createContext as e,useState as t,useMemo as r,createElement as n,useContext as o,useCallback as a}from"react";var s=(e,t)=>{const r=e.getItem(t);try{return r?JSON.parse(r):void 0}catch(e){return}};var i=e=>void 0===e;var c=e({store:{},updateStore:e=>e}),_=({transform:e,externalStoreName:t,storageType:r,store:n})=>e({externalStoreData:s(r,t),currentStoreData:n});const S="undefined"!=typeof window,E="production"!==process.env.NODE_ENV;let d,m,A,l=S&&(()=>{try{return!!window.sessionStorage}catch(e){return!1}})()?window.sessionStorage:{getItem:e=>e,setItem:e=>e,clear:()=>{},length:0,key:e=>e.toString(),removeItem:()=>{}},u=[];function T(e){l=e}function f(e,t={name:"__STATE_MACHINE__",middleWares:[],syncStores:void 0}){const r=t?t.name:"__STATE_MACHINE__",n=function(e,t){const r=t||"__STATE_MACHINE__";let n=s(e,r);return{set:e=>{n=e},get:()=>n,getName:()=>r}}(l,r);E&&S&&(window.STATE_MACHINE_NAME=r),A=n.getName,d=n.get,m=n.set,u=t.middleWares,function(e,t,r,n){"undefined"!=typeof window&&e&&(window.STATE_MACHINE_DEBUG=e=>t.setItem("___STATE_MACHINE_DEBUG__",e),window.STATE_MACHINE_RESET=()=>t.clear(),window.STATE_MACHINE_GET_STORE=()=>t.getItem(r()),window.STATE_MACHINE_SAVE_TO=e=>window.localStorage.setItem(e,JSON.stringify(n())),window.STATE_MACHINE_LOAD=({storeName:e,data:n})=>t.setItem(r()||"___STATE_MACHINE_DEBUG__",n||window.localStorage.getItem(e)||""))}(E,l,A,d),m(function(e,t,r){let n=e;const o=t.syncStores;if(!o)return n;try{if(Array.isArray(o))o.forEach(e=>{n=_({transform:e.transform,externalStoreName:e.externalStoreName,storageType:r,store:n})});else{if(o.externalStoreName&&"function"==typeof o.transform&&"string"==typeof o.externalStoreName)return _({transform:o.transform,externalStoreName:o.externalStoreName,storageType:r,store:n});Object.entries(o).forEach(([e,t])=>{const o=s(r,e);t.forEach(e=>{n=Object.assign(Object.assign({},n),{[e]:Object.assign(Object.assign({},n[e]),o[e])})})})}}catch(e){return n}return n}(d()||e,t,l))}function N(e){const[o,a]=t(d()),s=r(()=>({store:o,updateStore:a}),[o]);return n(c.Provider,Object.assign({value:s},e))}const g=({options:e,callback:t,updateStore:r})=>n=>{let o;const a=t?t.name:"";if(E&&((e="")=>{e&&S&&(window.__STATE_MACHINE_ACTION_NAME__=e)})(a),t&&(o=t(d(),n)),m(i(o)?d():o),l.setItem(A(),JSON.stringify(d())),i(e)||e&&!1!==e.shouldReRenderApp){let e=d();Array.isArray(u)&&u.length&&(e=u.reduce((e,t)=>t(e)||e,e)),r(e)}};function w(e,t){const{store:r,updateStore:n}=o(c);return e&&Object.keys(e).length?{actions:Object.entries(e).reduce((e,[r,o])=>Object.assign(Object.assign({},e),{[r]:a(g({options:t,callback:o,updateStore:n}),[])}),{}),action:e=>e,state:r}:{actions:{},action:a(e?g({options:t,callback:e,updateStore:n}):()=>{},[]),state:r}}export{c as StateMachineContext,N as StateMachineProvider,f as createStore,T as setStorageType,w as useStateMachine};
